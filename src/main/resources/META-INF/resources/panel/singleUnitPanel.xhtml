<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
             xmlns:p="http://primefaces.org/ui"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:f="http://xmlns.jcp.org/jsf/core"
>

    <!--@elvariable id="panelIndex" type="Integer"-->
    <!--@elvariable id="panelModel" type="fr.siamois.ui.bean.panel.models.panel.single.RecordingUnitPanel"-->

    <!-- Content -->
    <p:staticMessage severity="error" summary="Error" closable="false"
                     detail="#{panelModel.errorMessage}"
                     rendered="#{not empty panelModel.errorMessage}"/>
    <h:panelGroup id="unitContentPanel" rendered="#{panelModel.unit != null}">


        <h:form id="singlePanelUnitForm-#{panelIndex}">
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>

            <!-- Tabs -->
            <p:tabView id="singlePanelUnitTabs" activeIndex="#{panelModel.activeTabIndex}"
                       value="#{panelModel.tabs}" var="tabItem">
                <p:ajax event="tabChange" listener="#{panelModel.onTabChange}"/>

                <!-- Overview tab -->
                <p:tab>
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value='#{langBean.msg(tabItem.titleCode)}'/>
                            <ui:param name="icon" value="#{tabItem.icon}"/>
                            <ui:param name="emptyTab" value="#{panelModel.emptyTabFor(tabItem)}"/>
                            <ui:param name="validated" value="#{panelModel.unit.validated}"/>
                        </ui:include>
                    </f:facet>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'OverviewFormTab'}">
                        <ui:include src="/panel/tab/overviewTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                            <ui:param name="root" value="singlePanelUnitForm-#{panelIndex}:singlePanelUnitTabs:#{panelModel.getIndexOfTab(tabItem)}"/>
                        </ui:include>
                    </ui:fragment>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'DetailsFormTab'}">
                        <ui:include src="/panel/tab/detailsTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                            <ui:param name="root" value="singlePanelUnitForm-#{panelIndex}:singlePanelUnitTabs:#{panelModel.getIndexOfTab(tabItem)}"/>
                        </ui:include>
                    </ui:fragment>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'MultiHierarchyTab'}">
                        <ui:include src="/panel/tab/hierarchyTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                        </ui:include>
                    </ui:fragment>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'DocumentTab'}">
                        <ui:include src="/panel/tab/documentsTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                        </ui:include>
                    </ui:fragment>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'SpecimenTab'}">
                        <!--@elvariable id="tabItem" type="fr.siamois.ui.bean.panel.models.panel.single.tab.SpecimenTab"-->
                        <ui:include src="/panel/tab/specimenTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                            <ui:param name="lazyDataModel" value="#{tabItem.lazyDataModel}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                        </ui:include>
                    </ui:fragment>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'ActionTab'}">
                        <!--@elvariable id="tabItem" type="fr.siamois.ui.bean.panel.models.panel.single.tab.ActionTab"-->
                        <ui:include src="/panel/tab/actionTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                            <ui:param name="lazyDataModel" value="#{tabItem.lazyDataModel}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                        </ui:include>
                    </ui:fragment>

                    <ui:fragment rendered="#{tabItem['class'].simpleName eq 'RecordingTab'}">
                        <!--@elvariable id="tabItem" type="fr.siamois.ui.bean.panel.models.panel.single.tab.RecordingTab"-->
                        <ui:include src="/panel/tab/recordingUnitsTab.xhtml">
                            <ui:param name="panelModel" value="#{panelModel}"/>
                            <ui:param name="lazyDataModel" value="#{tabItem.lazyDataModel}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                        </ui:include>
                    </ui:fragment>

                </p:tab>


            </p:tabView>

            <!-- Save/Cancel Toolbar -->
            <p:toolbar class="panel-footer" >
                <p:toolbarGroup align="left">
                    Derni√®re modification le #{panelModel.lastUpdateDate()} par #{panelModel.lastUpdater()}
                </p:toolbarGroup>
                <p:toolbarGroup align="right" rendered="#{flowBean.readWriteMode == 'WRITE'}">
                    <p:commandLink value='#{langBean.msg("common.action.cancel")}'
                                   update="panel-#{panelIndex}"
                                   id="cancelButton"
                                   action="#{panelModel.cancelChanges()}"

                                   style="margin-right: 1rem">
                    </p:commandLink>
                    <p:commandButton id="saveButton" value='#{langBean.msg("common.action.save")}'
                                     update="panel-#{panelIndex}"

                                     action="#{panelModel.saveAction(false)}"
                                     style="margin-right: 1rem">
                    </p:commandButton>
                    <p:commandButton id="saveAndValidateButton" value='#{langBean.msg("common.action.saveAndValidate")}'
                                     update="panel-#{panelIndex}"
                                     action="#{panelModel.saveAction(true)}"

                                     style="margin-right: .5rem">
                    </p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>
        </h:form>

    </h:panelGroup>


</ui:fragment>